## 220831

![](./img/2022-08-31-15-33-28.png)  
内容

![](./img/2022-08-31-15-38-02.png)  
--=
![](./img/2022-08-31-15-38-53.png)  
ooop

![](./img/2022-08-31-15-39-36.png)  
如何设计交易费用

![](./img/2022-08-31-15-41-05.png)  
substrate 交易费用组成

![](./img/2022-08-31-15-41-34.png)  
基本费用

![](./img/2022-08-31-15-42-02.png)  
字节费用

![](./img/2022-08-31-15-42-40.png)  
--=
![](./img/2022-08-31-15-44-11.png)

权重费用

![](./img/2022-08-31-15-52-08.png)  
--=
![](./img/2022-08-31-15-52-55.png)  
默认权重

![](./img/2022-08-31-15-55-00.png)  
--=
![](./img/2022-08-31-15-55-33.png)
--=
![](./img/2022-08-31-15-56-15.png)
--=
![](./img/2022-08-31-15-56-46.png)
自定义权重

![](./img/2022-08-31-15-57-03.png)  
权重费用转换

![](./img/2022-08-31-15-57-36.png)  
动态调节费率

![](./img/2022-08-31-15-58-15.png)  
小费

![](./img/2022-08-31-15-58-36.png)  
资料

![](./img/2022-08-31-15-58-54.png)  
frame 组成  
mmmi  
lllf

![](./img/2022-08-31-16-35-00.png)  
frame 模块导读

![](./img/2022-08-31-16-39-54.png)  
这里打开了 substrate，注意不是 substrate-node-template  
bin 目录下包含节点的可执行程序  
分别是功能完善的 node 节点和模版程序节点 node-template
utils 包含了一些常用工具，如 subkey 用来管理密钥

![](./img/2022-08-31-16-42-23.png)  
目录 client 包含了一些节点所必要的组件，比如网络通信，p2p 消息机制，数据库读写，共识底层组件等。

![](./img/2022-08-31-16-44-06.png)  
primitives 里包含常用的 runtime 和客户端需要的公用的类型，方法，接口等等。

![](./img/2022-08-31-16-45-30.png)  
这次重点是 frame 目录，它里面是各种 runtime 开发所需要的支持的模块和业务模块，mmmi

![](./img/2022-08-31-16-48-32.png)  
--=
![](./img/2022-08-31-16-49-16.png)
frame/system 模块  
官方文档网页可读性更高  
https://crates.parity.io
https://crates.parity.io/frame_system/index.html
mmmi 有空看这些源代码  
1530-1814 frame/system 模块大致讲解 mmmi。

![](./img/2022-08-31-17-21-38.png)  
timestamp 模块，在链上记录当前时间戳。  
1818-1917

![](./img/2022-08-31-17-24-10.png)  
transaction-payment 模块  
用来计算交易的费用，并且对费用进行实际的扣除。  
1919-2055

![](./img/2022-08-31-17-25-59.png)  
utility 模块  
工具模块，提供了 batch，多个可调用函数一起发出。batch_all，类似 batch，但是有一致性，一个失败则全都回滚，确保批量的交易都被成功执行。
2055-2145
