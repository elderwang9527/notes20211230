## 221002

![](./img/2022-10-02-17-57-05.png =100x20000)  
<img src="./img/2022-10-02-17-57-05.png" height="250">
ooop

![](./img/2022-10-02-17-58-39.png =100x20)  
benchmark 确定交易权重

![](./img/2022-10-02-21-49-49.png)  
官方配置，benchmark 配置，希望验证人使用的配置

![](./img/2022-10-02-21-52-43.png)  
benchmark 可用选项

![](./img/2022-10-02-21-53-55.png)  
substrate 已经对数据库读写进行了 benchmark  
读是 25us 微秒，1s 对应 weight 基础值是 1\*10\*\*12，1 毫秒就是 1\*10\*\*9，1 微秒是 1\*10\*\*6

![](./img/2022-10-02-21-58-10.png)
用 substrate 内置的 benchmark 工具对可调用函数进行基本测试  
以及其它相关资料

![](./img/2022-10-02-21-59-43.png)  
--=  
![](./img/2022-10-02-22-02-45.png)  
--=  
![](./img/2022-10-03-10-19-55.png)  
1，下划线代替 create claim，用例跟可调用函数同名就可用下划线  
2，接下来构建 benchmark 需要的变量和数据，这里是定义 claim，因为 claim 有长度，这里给一个长度区间，从 0 到最大长度。在运行 benchmark 基本测试时，选 d 作为存证长度，每次测试使用不同的 d，从而让 bm 涵盖尽可能多的场景，给出准确的权重值  
3，开始构建存证。  
4，用 whitelist caller 构建交易发送方  
5，构建 bm 的测试环境  
6，verify 用来验证 bm 中数据是否正确，这里省略了。

![](./img/2022-10-03-10-22-24.png)  
--=  
![](./img/2022-10-03-10-23-02.png)  
--=  
![](./img/2022-10-03-10-25-48.png)  
--=  
![](./img/2022-10-03-10-26-33.png)

1，引入到 librs  
2，把 poe 模块 runtime bechmark 标签添入到 runtime 里  
3，runtime 的 librs 里引入 poe benchmark  
4，build 时加入指定的 flag

![](./img/2022-10-03-10-27-51.png)  
--=  
![](./img/2022-10-03-10-29-10.png)  
build 报错，加上 pub use 后子模块才可以依赖，然后 build 成功

![](./img/2022-10-03-10-35-50.png)
编译和运行的一些参数，ooov 1130

![](./img/2022-10-03-10-37-06.png)  
--= 1
![](./img/2022-10-03-10-37-25.png)  
--= 2
![](./img/2022-10-03-10-38-35.png)  
--= 3
![](./img/2022-10-03-10-39-03.png)  
--= 4
![](./img/2022-10-03-10-40-04.png)
1 的文件拷贝下来粘贴到新建的 2 里  
3 运行，4 拿到结果  
5，生成了 weightrs 和 rawjson

![](./img/2022-10-03-10-41-53.png)  
生成的 weightrs ooov

![](./img/2022-10-03-10-43-20.png)  
--= 1  
![](./img/2022-10-03-10-59-44.png)  
--= 2  
![](./img/2022-10-03-10-59-27.png)  
--= 3  
1，引入 weightinfo  
2，定义 wi 接口，通过接口形式将权重值传给可调用函数，在模块配置接口 config 里定义  
3，使用配置接口的 weightinfo ，create claim bm 给出的结果替代原来的默认权重值。（所以这里的 T 意思是配置接口？？？？）

![](./img/2022-10-03-11-10-45.png)  
--=  
![](./img/2022-10-03-11-11-20.png)  
具体使用 weightinfo 的哪一个实现需要在 runtime 里定义  
1 是新增的代码，2 是 1 依赖的已写的代码。
